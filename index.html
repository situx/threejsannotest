<html>
<head>
<script
  src="https://code.jquery.com/jquery-3.7.1.min.js"
  integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
  crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/three/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three/examples/js/controls/TrackballControls.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three/examples/js/controls/OrbitControls.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three/examples/js/loaders/PLYLoader.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three/examples/js/loaders/GLTFLoader.js"></script>
<script src="https://cdn.jsdelivr.net/npm/threex.domevents@1.0.1/threex.domevents.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.9/dat.gui.min.js"></script>
<script>
var wktsampleannotations={"#ab5f734e-c3d1-432a-8cf4-21c4961663ce":{"type":"Annotation","body":[{"type":"TextualBody","purpose":"Transliteration","value":"szu","source":"http://purl.org/cuneiform/Transliteration"},{"type":"TextualBody","value":"Character","purpose":"tagging","source":"http://purl.org/cuneiform/Character"},{"type":"TextualBody","purpose":"Line","value":"2","source":"http://purl.org/cuneiform/Line"},{"type":"TextualBody","purpose":"Charindex","value":"1","source":"http://purl.org/cuneiform/CharacterIndex"},{"type":"TextualBody","purpose":"Wordindex","value":"1","source":"http://purl.org/cuneiform/WordIndex"},{"type":"TextualBody","purpose":"RelCharindex","value":"0","source":"http://purl.org/cuneiform/RelativeCharacterIndex"}],"target":{"source":"https://heidicon.ub.uni-heidelberg.de/eas/partitions/1/0/577000/577625/394a3193b8abd18076a3c19198df8eebc462650b/application/x-ply/HS_1185_HeiCuBeDa_GigaMesh.ply","selector":{"type":"WKTSelector","value":"POLYGON Z((NaN NaN 0.0,NaN NaN 0.0,NaN NaN 0.0,NaN NaN -3.2953948974609375,NaN NaN -3.2953948974609375,NaN NaN -3.2953948974609375,NaN NaN -3.2953948974609375))"},"rights":"https://creativecommons.org/licenses/by-sa/4.0/"},"@context":"http://www.w3.org/ns/anno.jsonld","id":"#ab5f734e-c3d1-432a-8cf4-21c4961663ce","rights":"https://creativecommons.org/publicdomain/zero/1.0/","creator":{"id":"https://orcid.org/0000-0002-9499-5840","type":"Person","name":"Timo Homburg","nickname":"situx"},"generator":{"id":"https://github.com/recogito/annotorious-openseadragon","type":"Software","name":"Annotorious-OpenSeadragon 1.5.6","homepage":"https://github.com/recogito/annotorious-openseadragon"}},"#554f369a-f39d-4edc-ad2f-67ed34ca709f":{"type":"Annotation","body":[{"type":"TextualBody","purpose":"Transliteration","value":"ba","source":"http://purl.org/cuneiform/Transliteration"},{"type":"TextualBody","value":"Character","purpose":"tagging","source":"http://purl.org/cuneiform/Character"},{"type":"TextualBody","value":"Wordstart","purpose":"tagging","source":"http://purl.org/cuneiform/Wordstart"},{"type":"TextualBody","purpose":"Line","value":"2","source":"http://purl.org/cuneiform/Line"},{"type":"TextualBody","purpose":"Charindex","value":"2","source":"http://purl.org/cuneiform/CharacterIndex"},{"type":"TextualBody","purpose":"Wordindex","value":"2","source":"http://purl.org/cuneiform/WordIndex"},{"type":"TextualBody","purpose":"RelCharindex","value":"0","source":"http://purl.org/cuneiform/RelativeCharacterIndex"}],"target":{"source":"https://heidicon.ub.uni-heidelberg.de/eas/partitions/1/0/577000/577625/394a3193b8abd18076a3c19198df8eebc462650b/application/x-ply/HS_1185_HeiCuBeDa_GigaMesh.ply","selector":{"type":"WKTSelector","value":"POLYGON Z((NaN NaN 0.0,NaN NaN 0.0,NaN NaN 0.0,NaN NaN -3.2953948974609375,NaN NaN -3.2953948974609375,NaN NaN -3.2953948974609375,NaN NaN -3.2953948974609375))"},"rights":"https://creativecommons.org/licenses/by-sa/4.0/"},"@context":"http://www.w3.org/ns/anno.jsonld","id":"#554f369a-f39d-4edc-ad2f-67ed34ca709f","rights":"https://creativecommons.org/publicdomain/zero/1.0/","creator":{"id":"https://orcid.org/0000-0002-9499-5840","type":"Person","name":"Timo Homburg","nickname":"situx"},"generator":{"id":"https://github.com/recogito/annotorious-openseadragon","type":"Software","name":"Annotorious-OpenSeadragon 1.5.6","homepage":"https://github.com/recogito/annotorious-openseadragon"}},"#bc338bb4-6812-45bd-9e52-b90a5b95213d":{"type":"Annotation","body":[{"type":"TextualBody","purpose":"Transliteration","value":"ti","source":"http://purl.org/cuneiform/Transliteration"},{"type":"TextualBody","value":"Character","purpose":"tagging","source":"http://purl.org/cuneiform/Character"},{"type":"TextualBody","value":"Wordend","purpose":"tagging","source":"http://purl.org/cuneiform/Wordend"},{"type":"TextualBody","purpose":"Line","value":"2","source":"http://purl.org/cuneiform/Line"},{"type":"TextualBody","purpose":"Charindex","value":"3","source":"http://purl.org/cuneiform/CharacterIndex"},{"type":"TextualBody","purpose":"Wordindex","value":"2","source":"http://purl.org/cuneiform/WordIndex"},{"type":"TextualBody","purpose":"RelCharindex","value":"1","source":"http://purl.org/cuneiform/RelativeCharacterIndex"}],"target":{"source":"https://heidicon.ub.uni-heidelberg.de/eas/partitions/1/0/577000/577625/394a3193b8abd18076a3c19198df8eebc462650b/application/x-ply/HS_1185_HeiCuBeDa_GigaMesh.ply","selector":{"type":"WKTSelector","value":"POLYGON Z((NaN NaN 0.0,NaN NaN 0.0,NaN NaN 0.0,NaN NaN -3.2953948974609375,NaN NaN -3.2953948974609375,NaN NaN -3.2953948974609375,NaN NaN -3.2953948974609375))"},"rights":"https://creativecommons.org/licenses/by-sa/4.0/"},"@context":"http://www.w3.org/ns/anno.jsonld","id":"#bc338bb4-6812-45bd-9e52-b90a5b95213d","rights":"https://creativecommons.org/publicdomain/zero/1.0/","creator":{"id":"https://orcid.org/0000-0002-9499-5840","type":"Person","name":"Timo Homburg","nickname":"situx"},"generator":{"id":"https://github.com/recogito/annotorious-openseadragon","type":"Software","name":"Annotorious-OpenSeadragon 1.5.6","homepage":"https://github.com/recogito/annotorious-openseadragon"}},"#a64af526-639a-4a1b-8d42-1e84035b43c9":{"type":"Annotation","body":[{"type":"TextualBody","purpose":"Transliteration","value":"a","source":"http://purl.org/cuneiform/Transliteration"},{"type":"TextualBody","value":"Character","purpose":"tagging","source":"http://purl.org/cuneiform/Character"},{"type":"TextualBody","value":"Wordend","purpose":"tagging","source":"http://purl.org/cuneiform/Wordend"},{"type":"TextualBody","purpose":"Line","value":"3","source":"http://purl.org/cuneiform/Line"},{"type":"TextualBody","purpose":"Charindex","value":"4","source":"http://purl.org/cuneiform/CharacterIndex"},{"type":"TextualBody","purpose":"Wordindex","value":"3","source":"http://purl.org/cuneiform/WordIndex"},{"type":"TextualBody","purpose":"RelCharindex","value":"1","source":"http://purl.org/cuneiform/RelativeCharacterIndex"}],"target":{"source":"https://heidicon.ub.uni-heidelberg.de/eas/partitions/1/0/577000/577625/394a3193b8abd18076a3c19198df8eebc462650b/application/x-ply/HS_1185_HeiCuBeDa_GigaMesh.ply","selector":{"type":"WKTSelector","value":"POLYGON Z((NaN NaN 0.0,NaN NaN 0.0,NaN NaN 0.0,NaN NaN -3.2953948974609375,NaN NaN -3.2953948974609375,NaN NaN -3.2953948974609375,NaN NaN -3.2953948974609375))"},"rights":"https://creativecommons.org/licenses/by-sa/4.0/"},"@context":"http://www.w3.org/ns/anno.jsonld","id":"#a64af526-639a-4a1b-8d42-1e84035b43c9","rights":"https://creativecommons.org/publicdomain/zero/1.0/","creator":{"id":"https://orcid.org/0000-0002-9499-5840","type":"Person","name":"Timo Homburg","nickname":"situx"},"generator":{"id":"https://github.com/recogito/annotorious-openseadragon","type":"Software","name":"Annotorious-OpenSeadragon 1.5.6","homepage":"https://github.com/recogito/annotorious-openseadragon"}},"#b61e5aab-70e4-4889-a96d-3d3c33ab592c":{"type":"Annotation","body":[{"type":"TextualBody","purpose":"Transliteration","value":"du8","source":"http://purl.org/cuneiform/Transliteration"},{"type":"TextualBody","value":"Character","purpose":"tagging","source":"http://purl.org/cuneiform/Character"},{"type":"TextualBody","value":"InWord","purpose":"tagging","source":"http://purl.org/cuneiform/InWord"},{"type":"TextualBody","purpose":"Line","value":"3","source":"http://purl.org/cuneiform/Line"},{"type":"TextualBody","purpose":"Charindex","value":"3","source":"http://purl.org/cuneiform/CharacterIndex"},{"type":"TextualBody","purpose":"Wordindex","value":"3","source":"http://purl.org/cuneiform/WordIndex"},{"type":"TextualBody","purpose":"RelCharindex","value":"0","source":"http://purl.org/cuneiform/RelativeCharacterIndex"}],"target":{"source":"https://heidicon.ub.uni-heidelberg.de/eas/partitions/1/0/577000/577625/394a3193b8abd18076a3c19198df8eebc462650b/application/x-ply/HS_1185_HeiCuBeDa_GigaMesh.ply","selector":{"type":"WKTSelector","value":"POLYGON Z((NaN NaN 0.0,NaN NaN 0.0,NaN NaN 0.0,NaN NaN -3.2953948974609375,NaN NaN -3.2953948974609375,NaN NaN -3.2953948974609375,NaN NaN -3.2953948974609375))"},"rights":"https://creativecommons.org/licenses/by-sa/4.0/"},"@context":"http://www.w3.org/ns/anno.jsonld","id":"#b61e5aab-70e4-4889-a96d-3d3c33ab592c","rights":"https://creativecommons.org/publicdomain/zero/1.0/","creator":{"id":"https://orcid.org/0000-0002-9499-5840","type":"Person","name":"Timo Homburg","nickname":"situx"},"generator":{"id":"https://github.com/recogito/annotorious-openseadragon","type":"Software","name":"Annotorious-OpenSeadragon 1.5.6","homepage":"https://github.com/recogito/annotorious-openseadragon"}},"#af0831c0-e174-4078-9d31-c788340fa934":{"type":"Annotation","body":[{"type":"TextualBody","purpose":"Transliteration","value":"9(disz)","source":"http://purl.org/cuneiform/Transliteration"},{"type":"TextualBody","value":"Character","purpose":"tagging","source":"http://purl.org/cuneiform/Character"},{"type":"TextualBody","purpose":"Line","value":"4","source":"http://purl.org/cuneiform/Line"},{"type":"TextualBody","purpose":"Charindex","value":"2","source":"http://purl.org/cuneiform/CharacterIndex"},{"type":"TextualBody","purpose":"Wordindex","value":"2","source":"http://purl.org/cuneiform/WordIndex"},{"type":"TextualBody","purpose":"RelCharindex","value":"0","source":"http://purl.org/cuneiform/RelativeCharacterIndex"}],"target":{"source":"https://heidicon.ub.uni-heidelberg.de/eas/partitions/1/0/577000/577625/394a3193b8abd18076a3c19198df8eebc462650b/application/x-ply/HS_1185_HeiCuBeDa_GigaMesh.ply","selector":{"type":"WKTSelector","value":"POLYGON Z((NaN NaN 0.0,NaN NaN 0.0,NaN NaN 0.0,NaN NaN -3.2953948974609375,NaN NaN -3.2953948974609375,NaN NaN -3.2953948974609375,NaN NaN -3.2953948974609375))"},"rights":"https://creativecommons.org/licenses/by-sa/4.0/"},"@context":"http://www.w3.org/ns/anno.jsonld","id":"#af0831c0-e174-4078-9d31-c788340fa934","rights":"https://creativecommons.org/publicdomain/zero/1.0/","creator":{"id":"https://orcid.org/0000-0002-9499-5840","type":"Person","name":"Timo Homburg","nickname":"situx"},"generator":{"id":"https://github.com/recogito/annotorious-openseadragon","type":"Software","name":"Annotorious-OpenSeadragon 1.5.6","homepage":"https://github.com/recogito/annotorious-openseadragon"}},"#2595f84f-072b-430c-90f6-7009a2d8de77":{"type":"Annotation","body":[{"type":"TextualBody","purpose":"Transliteration","value":"ba","source":"http://purl.org/cuneiform/Transliteration"},{"type":"TextualBody","value":"Character","purpose":"tagging","source":"http://purl.org/cuneiform/Character"},{"type":"TextualBody","value":"Wordstart","purpose":"tagging","source":"http://purl.org/cuneiform/Wordstart"},{"type":"TextualBody","purpose":"Line","value":"4","source":"http://purl.org/cuneiform/Line"},{"type":"TextualBody","purpose":"Charindex","value":"3","source":"http://purl.org/cuneiform/CharacterIndex"},{"type":"TextualBody","purpose":"Wordindex","value":"3","source":"http://purl.org/cuneiform/WordIndex"},{"type":"TextualBody","purpose":"RelCharindex","value":"0","source":"http://purl.org/cuneiform/RelativeCharacterIndex"}],"target":{"source":"https://heidicon.ub.uni-heidelberg.de/eas/partitions/1/0/577000/577625/394a3193b8abd18076a3c19198df8eebc462650b/application/x-ply/HS_1185_HeiCuBeDa_GigaMesh.ply","selector":{"type":"WKTSelector","value":"POLYGON Z((NaN NaN 0.0,NaN NaN 0.0,NaN NaN 0.0,NaN NaN -3.2953948974609375,NaN NaN -3.2953948974609375,NaN NaN -3.2953948974609375,NaN NaN -3.2953948974609375))"},"rights":"https://creativecommons.org/licenses/by-sa/4.0/"},"@context":"http://www.w3.org/ns/anno.jsonld","id":"#2595f84f-072b-430c-90f6-7009a2d8de77","rights":"https://creativecommons.org/publicdomain/zero/1.0/","creator":{"id":"https://orcid.org/0000-0002-9499-5840","type":"Person","name":"Timo Homburg","nickname":"situx"},"generator":{"id":"https://github.com/recogito/annotorious-openseadragon","type":"Software","name":"Annotorious-OpenSeadragon 1.5.6","homepage":"https://github.com/recogito/annotorious-openseadragon"}},"#21e96fa4-64f3-4f2e-b946-4832c15c8a82":{"type":"Annotation","body":[{"type":"TextualBody","purpose":"Transliteration","value":"zal","source":"http://purl.org/cuneiform/Transliteration"},{"type":"TextualBody","value":"Character","purpose":"tagging","source":"http://purl.org/cuneiform/Character"},{"type":"TextualBody","value":"Wordend","purpose":"tagging","source":"http://purl.org/cuneiform/Wordend"},{"type":"TextualBody","purpose":"Line","value":"4","source":"http://purl.org/cuneiform/Line"},{"type":"TextualBody","purpose":"Charindex","value":"4","source":"http://purl.org/cuneiform/CharacterIndex"},{"type":"TextualBody","purpose":"Wordindex","value":"3","source":"http://purl.org/cuneiform/WordIndex"},{"type":"TextualBody","purpose":"RelCharindex","value":"1","source":"http://purl.org/cuneiform/RelativeCharacterIndex"}],"target":{"source":"https://heidicon.ub.uni-heidelberg.de/eas/partitions/1/0/577000/577625/394a3193b8abd18076a3c19198df8eebc462650b/application/x-ply/HS_1185_HeiCuBeDa_GigaMesh.ply","selector":{"type":"WKTSelector","value":"POLYGON Z((NaN NaN 0.0,NaN NaN 0.0,NaN NaN 0.0,NaN NaN -3.2953948974609375,NaN NaN -3.2953948974609375,NaN NaN -3.2953948974609375,NaN NaN -3.2953948974609375))"},"rights":"https://creativecommons.org/licenses/by-sa/4.0/"},"@context":"http://www.w3.org/ns/anno.jsonld","id":"#21e96fa4-64f3-4f2e-b946-4832c15c8a82","rights":"https://creativecommons.org/publicdomain/zero/1.0/","creator":{"id":"https://orcid.org/0000-0002-9499-5840","type":"Person","name":"Timo Homburg","nickname":"situx"},"generator":{"id":"https://github.com/recogito/annotorious-openseadragon","type":"Software","name":"Annotorious-OpenSeadragon 1.5.6","homepage":"https://github.com/recogito/annotorious-openseadragon"}},"#fc3476d4-a5e2-42e6-a5ec-922f328191b0":{"type":"Annotation","body":[{"type":"TextualBody","purpose":"Transliteration","value":"u4","source":"http://purl.org/cuneiform/Transliteration"},{"type":"TextualBody","value":"Character","purpose":"tagging","source":"http://purl.org/cuneiform/Character"},{"type":"TextualBody","purpose":"Line","value":"4","source":"http://purl.org/cuneiform/Line"},{"type":"TextualBody","purpose":"Charindex","value":"1","source":"http://purl.org/cuneiform/CharacterIndex"},{"type":"TextualBody","purpose":"Wordindex","value":"1","source":"http://purl.org/cuneiform/WordIndex"},{"type":"TextualBody","purpose":"RelCharindex","value":"0","source":"http://purl.org/cuneiform/RelativeCharacterIndex"}],"target":{"source":"https://heidicon.ub.uni-heidelberg.de/eas/partitions/1/0/577000/577625/394a3193b8abd18076a3c19198df8eebc462650b/application/x-ply/HS_1185_HeiCuBeDa_GigaMesh.ply","selector":{"type":"WKTSelector","value":"POLYGON Z((NaN NaN 0.0,NaN NaN 0.0,NaN NaN 0.0,NaN NaN -3.2953948974609375,NaN NaN -3.2953948974609375,NaN NaN -3.2953948974609375,NaN NaN -3.2953948974609375))"},"rights":"https://creativecommons.org/licenses/by-sa/4.0/"},"@context":"http://www.w3.org/ns/anno.jsonld","id":"#fc3476d4-a5e2-42e6-a5ec-922f328191b0","rights":"https://creativecommons.org/publicdomain/zero/1.0/","creator":{"id":"https://orcid.org/0000-0002-9499-5840","type":"Person","name":"Timo Homburg","nickname":"situx"},"generator":{"id":"https://github.com/recogito/annotorious-openseadragon","type":"Software","name":"Annotorious-OpenSeadragon 1.5.6","homepage":"https://github.com/recogito/annotorious-openseadragon"}},"#d0042c3d-8e23-4478-94c6-e59b7d190df1":{"type":"Annotation","body":[{"type":"TextualBody","purpose":"Transliteration","value":"mi","source":"http://purl.org/cuneiform/Transliteration"},{"type":"TextualBody","value":"Character","purpose":"tagging","source":"http://purl.org/cuneiform/Character"},{"type":"TextualBody","purpose":"Line","value":"1","source":"http://purl.org/cuneiform/Line"},{"type":"TextualBody","purpose":"Charindex","value":"2","source":"http://purl.org/cuneiform/CharacterIndex"},{"type":"TextualBody","purpose":"Wordindex","value":"2","source":"http://purl.org/cuneiform/WordIndex"},{"type":"TextualBody","purpose":"RelCharindex","value":"0","source":"http://purl.org/cuneiform/RelativeCharacterIndex"}],"target":{"source":"https://heidicon.ub.uni-heidelberg.de/eas/partitions/1/0/577000/577625/394a3193b8abd18076a3c19198df8eebc462650b/application/x-ply/HS_1185_HeiCuBeDa_GigaMesh.ply","selector":{"type":"WKTSelector","value":"POLYGON Z((-4.695420838246304 0.26020160103486445 0.0,2.130152948767739 3.3851635001083014 0.0,-4.695420838246304 3.3851635001083014 0.0,-4.695420838246304 0.26020160103486445 -3.2953948974609375,2.130152948767739 0.26020160103486445 -3.2953948974609375,2.130152948767739 3.3851635001083014 -3.2953948974609375,-4.695420838246304 3.3851635001083014 -3.2953948974609375))"},"rights":"https://creativecommons.org/licenses/by-sa/4.0/","dimensions":{"x":565,"y":594}},"@context":"http://www.w3.org/ns/anno.jsonld","id":"#d0042c3d-8e23-4478-94c6-e59b7d190df1","rights":"https://creativecommons.org/publicdomain/zero/1.0/","creator":{"id":"https://orcid.org/0000-0002-9499-5840","type":"Person","name":"Timo Homburg","nickname":"situx"},"generator":{"id":"https://github.com/recogito/annotorious-openseadragon","type":"Software","name":"Annotorious-OpenSeadragon 1.5.6","homepage":"https://github.com/recogito/annotorious-openseadragon"}},"#83d1a4be-8826-4bb2-bf25-8aa176a04b25":{"type":"Annotation","body":[{"type":"TextualBody","purpose":"Transliteration","value":"iti","source":"http://purl.org/cuneiform/Transliteration"},{"type":"TextualBody","value":"Character","purpose":"tagging","source":"http://purl.org/cuneiform/Character"},{"type":"TextualBody","purpose":"Line","value":"3","source":"http://purl.org/cuneiform/Line"},{"type":"TextualBody","purpose":"Charindex","value":"1","source":"http://purl.org/cuneiform/CharacterIndex"},{"type":"TextualBody","purpose":"Wordindex","value":"1","source":"http://purl.org/cuneiform/WordIndex"},{"type":"TextualBody","purpose":"RelCharindex","value":"0","source":"http://purl.org/cuneiform/RelativeCharacterIndex"}],"target":{"source":"https://heidicon.ub.uni-heidelberg.de/eas/partitions/1/0/577000/577625/394a3193b8abd18076a3c19198df8eebc462650b/application/x-ply/HS_1185_HeiCuBeDa_GigaMesh.ply","selector":{"type":"WKTSelector","value":"POLYGON Z((-11.520994625260345 13.541077781542382 0.0,-5.869169922212584 18.271746303288623 0.0,-11.520994625260345 18.271746303288623 0.0,-11.520994625260345 13.541077781542382 -3.2953948974609375,-5.869169922212584 13.541077781542382 -3.2953948974609375,-5.869169922212584 18.271746303288623 -3.2953948974609375,-11.520994625260345 18.271746303288623 -3.2953948974609375))"},"rights":"https://creativecommons.org/licenses/by-sa/4.0/","dimensions":{"x":565,"y":594}},"@context":"http://www.w3.org/ns/anno.jsonld","id":"#83d1a4be-8826-4bb2-bf25-8aa176a04b25","rights":"https://creativecommons.org/publicdomain/zero/1.0/","creator":{"id":"https://orcid.org/0000-0002-9499-5840","type":"Person","name":"Timo Homburg","nickname":"situx"},"generator":{"id":"https://github.com/recogito/annotorious-openseadragon","type":"Software","name":"Annotorious-OpenSeadragon 1.5.6","homepage":"https://github.com/recogito/annotorious-openseadragon"}},"#c933e9b3-1cd8-4784-a928-5e55e50e776c":{"type":"Annotation","body":[{"type":"TextualBody","purpose":"Transliteration","value":"apin","source":"http://purl.org/cuneiform/Transliteration"},{"type":"TextualBody","value":"Character","purpose":"tagging","source":"http://purl.org/cuneiform/Character"},{"type":"TextualBody","value":"Wordstart","purpose":"tagging","source":"http://purl.org/cuneiform/Wordstart"},{"type":"TextualBody","purpose":"Line","value":"3","source":"http://purl.org/cuneiform/Line"},{"type":"TextualBody","purpose":"Charindex","value":"2","source":"http://purl.org/cuneiform/CharacterIndex"},{"type":"TextualBody","purpose":"Wordindex","value":"2","source":"http://purl.org/cuneiform/WordIndex"},{"type":"TextualBody","purpose":"RelCharindex","value":"0","source":"http://purl.org/cuneiform/RelativeCharacterIndex"}],"target":{"source":"https://heidicon.ub.uni-heidelberg.de/eas/partitions/1/0/577000/577625/394a3193b8abd18076a3c19198df8eebc462650b/application/x-ply/HS_1185_HeiCuBeDa_GigaMesh.ply","selector":{"type":"WKTSelector","value":"POLYGON Z((-5.434479483882939 13.584727235787645 0.0,2.043129960625574 18.098419829635105 0.0,-5.434479483882939 18.098419829635105 0.0,-5.434479483882939 13.584727235787645 -3.2953948974609375,2.043129960625574 13.584727235787645 -3.2953948974609375,2.043129960625574 18.098419829635105 -3.2953948974609375,-5.434479483882939 18.098419829635105 -3.2953948974609375))"},"rights":"https://creativecommons.org/licenses/by-sa/4.0/","dimensions":{"x":565,"y":594}},"@context":"http://www.w3.org/ns/anno.jsonld","id":"#c933e9b3-1cd8-4784-a928-5e55e50e776c","rights":"https://creativecommons.org/publicdomain/zero/1.0/","creator":{"id":"https://orcid.org/0000-0002-9499-5840","type":"Person","name":"Timo Homburg","nickname":"situx"},"generator":{"id":"https://github.com/recogito/annotorious-openseadragon","type":"Software","name":"Annotorious-OpenSeadragon 1.5.6","homepage":"https://github.com/recogito/annotorious-openseadragon"}},"#9f06bd40-69e5-47c1-b431-c99d81578040":{"type":"Annotation","body":[{"type":"TextualBody","purpose":"Transliteration","value":"bat5","source":"http://purl.org/cuneiform/Transliteration"},{"type":"TextualBody","value":"Character","purpose":"tagging","source":"http://purl.org/cuneiform/Character"},{"type":"TextualBody","purpose":"Line","value":"1","source":"http://purl.org/cuneiform/Line"},{"type":"TextualBody","purpose":"Charindex","value":"4","source":"http://purl.org/cuneiform/CharacterIndex"},{"type":"TextualBody","purpose":"Wordindex","value":"1","source":"http://purl.org/cuneiform/WordIndex"},{"type":"TextualBody","purpose":"RelCharindex","value":"3","source":"http://purl.org/cuneiform/RelativeCharacterIndex"}],"target":{"source":"https://heidicon.ub.uni-heidelberg.de/eas/partitions/1/0/577000/577625/394a3193b8abd18076a3c19198df8eebc462650b/application/x-ply/HS_1185_HeiCuBeDa_GigaMesh.ply","selector":{"type":"WKTSelector","value":"POLYGON Z((-2.7388893633817144 3.4720386274896486 0.0,4.65169709298463 8.159481476099804 0.0,-2.7388893633817144 8.159481476099804 0.0,-2.7388893633817144 3.4720386274896486 -3.2953948974609375,4.65169709298463 3.4720386274896486 -3.2953948974609375,4.65169709298463 8.159481476099804 -3.2953948974609375,-2.7388893633817144 8.159481476099804 -3.2953948974609375))"},"rights":"https://creativecommons.org/licenses/by-sa/4.0/","dimensions":{"x":565,"y":594}},"@context":"http://www.w3.org/ns/anno.jsonld","id":"#9f06bd40-69e5-47c1-b431-c99d81578040","rights":"https://creativecommons.org/publicdomain/zero/1.0/","creator":{"id":"https://orcid.org/0000-0002-9499-5840","type":"Person","name":"Timo Homburg","nickname":"situx"},"generator":{"id":"https://github.com/recogito/annotorious-openseadragon","type":"Software","name":"Annotorious-OpenSeadragon 1.5.6","homepage":"https://github.com/recogito/annotorious-openseadragon"}},"#65556608-c7af-4449-9ce8-590bac418270":{"type":"Annotation","body":[{"type":"TextualBody","purpose":"Transliteration","value":"e","source":"http://purl.org/cuneiform/Transliteration"},{"type":"TextualBody","value":"Character","purpose":"tagging","source":"http://purl.org/cuneiform/Character"},{"type":"TextualBody","purpose":"Line","value":"1","source":"http://purl.org/cuneiform/Line"},{"type":"TextualBody","purpose":"Charindex","value":"5","source":"http://purl.org/cuneiform/CharacterIndex"},{"type":"TextualBody","purpose":"Wordindex","value":"1","source":"http://purl.org/cuneiform/WordIndex"},{"type":"TextualBody","purpose":"RelCharindex","value":"4","source":"http://purl.org/cuneiform/RelativeCharacterIndex"}],"target":{"source":"https://heidicon.ub.uni-heidelberg.de/eas/partitions/1/0/577000/577625/394a3193b8abd18076a3c19198df8eebc462650b/application/x-ply/HS_1185_HeiCuBeDa_GigaMesh.ply","selector":{"type":"WKTSelector","value":"POLYGON Z((4.825743069268963 3.645788882252343 0.0,10.086176576867569 8.159481476099804 0.0,4.825743069268963 8.159481476099804 0.0,4.825743069268963 3.645788882252343 -3.2953948974609375,10.086176576867569 3.645788882252343 -3.2953948974609375,10.086176576867569 8.159481476099804 -3.2953948974609375,4.825743069268963 8.159481476099804 -3.2953948974609375))"},"rights":"https://creativecommons.org/licenses/by-sa/4.0/","dimensions":{"x":565,"y":594}},"@context":"http://www.w3.org/ns/anno.jsonld","id":"#65556608-c7af-4449-9ce8-590bac418270","rights":"https://creativecommons.org/publicdomain/zero/1.0/","creator":{"id":"https://orcid.org/0000-0002-9499-5840","type":"Person","name":"Timo Homburg","nickname":"situx"},"generator":{"id":"https://github.com/recogito/annotorious-openseadragon","type":"Software","name":"Annotorious-OpenSeadragon 1.5.6","homepage":"https://github.com/recogito/annotorious-openseadragon"}},"#e5cefee7-ba96-4cbd-a007-957838d82227":{"type":"Annotation","body":[{"type":"TextualBody","purpose":"Transliteration","value":"t,a","source":"http://purl.org/cuneiform/Transliteration"},{"type":"TextualBody","value":"Character","purpose":"tagging","source":"http://purl.org/cuneiform/Character"},{"type":"TextualBody","purpose":"Line","value":"1","source":"http://purl.org/cuneiform/Line"},{"type":"TextualBody","purpose":"Charindex","value":"3","source":"http://purl.org/cuneiform/CharacterIndex"},{"type":"TextualBody","purpose":"Wordindex","value":"2","source":"http://purl.org/cuneiform/WordIndex"},{"type":"TextualBody","purpose":"RelCharindex","value":"1","source":"http://purl.org/cuneiform/RelativeCharacterIndex"}],"target":{"source":"https://heidicon.ub.uni-heidelberg.de/eas/partitions/1/0/577000/577625/394a3193b8abd18076a3c19198df8eebc462650b/application/x-ply/HS_1185_HeiCuBeDa_GigaMesh.ply","selector":{"type":"WKTSelector","value":"POLYGON Z((1.5651402794154343 0.13010080051743222 0.0,10.042877333987075 3.9059904832872077 0.0,1.5651402794154343 3.9059904832872077 0.0,1.5651402794154343 0.13010080051743222 -3.2953948974609375,10.042877333987075 0.13010080051743222 -3.2953948974609375,10.042877333987075 3.9059904832872077 -3.2953948974609375,1.5651402794154343 3.9059904832872077 -3.2953948974609375))"},"rights":"https://creativecommons.org/licenses/by-sa/4.0/","dimensions":{"x":565,"y":594}},"@context":"http://www.w3.org/ns/anno.jsonld","id":"#e5cefee7-ba96-4cbd-a007-957838d82227","rights":"https://creativecommons.org/publicdomain/zero/1.0/","creator":{"id":"https://orcid.org/0000-0002-9499-5840","type":"Person","name":"Timo Homburg","nickname":"situx"},"generator":{"id":"https://github.com/recogito/annotorious-openseadragon","type":"Software","name":"Annotorious-OpenSeadragon 1.5.6","homepage":"https://github.com/recogito/annotorious-openseadragon"}},"#284aa7db-47de-447f-900a-14122923b219":{"type":"Annotation","body":[{"type":"TextualBody","purpose":"Transliteration","value":"mu","source":"http://purl.org/cuneiform/Transliteration"},{"type":"TextualBody","value":"Character","purpose":"tagging","source":"http://purl.org/cuneiform/Character"},{"type":"TextualBody","purpose":"Line","value":"5","source":"http://purl.org/cuneiform/Line"},{"type":"TextualBody","purpose":"Charindex","value":"1","source":"http://purl.org/cuneiform/CharacterIndex"}],"target":{"source":"https://heidicon.ub.uni-heidelberg.de/eas/partitions/1/0/577000/577625/394a3193b8abd18076a3c19198df8eebc462650b/application/x-ply/HS_1185_HeiCuBeDa_GigaMesh.ply","selector":{"type":"WKTSelector","value":"POLYGON Z((-10.95555745352686 21.917535185540967 0.0,-6.043215898496915 24.17416959191011 0.0,-10.95555745352686 24.17416959191011 0.0,-10.95555745352686 21.917535185540967 -3.2953948974609375,-6.043215898496915 21.917535185540967 -3.2953948974609375,-6.043215898496915 24.17416959191011 -3.2953948974609375,-10.95555745352686 24.17416959191011 -3.2953948974609375))"},"rights":"https://creativecommons.org/licenses/by-sa/4.0/","dimensions":{"x":565,"y":594}},"@context":"http://www.w3.org/ns/anno.jsonld","id":"#284aa7db-47de-447f-900a-14122923b219","rights":"https://creativecommons.org/publicdomain/zero/1.0/","creator":{"id":"https://orcid.org/0000-0002-9499-5840","type":"Person","name":"Timo Homburg","nickname":"situx"},"generator":{"id":"https://github.com/recogito/annotorious-openseadragon","type":"Software","name":"Annotorious-OpenSeadragon 1.5.6","homepage":"https://github.com/recogito/annotorious-openseadragon"}},"#fbab234d-0085-4edc-a453-7bdc3544b3cf":{"type":"Annotation","body":[{"type":"TextualBody","purpose":"Transliteration","value":"en","source":"http://purl.org/cuneiform/Transliteration"},{"type":"TextualBody","value":"Character","purpose":"tagging","source":"http://purl.org/cuneiform/Character"},{"type":"TextualBody","purpose":"Line","value":"5","source":"http://purl.org/cuneiform/Line"},{"type":"TextualBody","purpose":"Charindex","value":"2","source":"http://purl.org/cuneiform/CharacterIndex"}],"target":{"source":"https://heidicon.ub.uni-heidelberg.de/eas/partitions/1/0/577000/577625/394a3193b8abd18076a3c19198df8eebc462650b/application/x-ply/HS_1185_HeiCuBeDa_GigaMesh.ply","selector":{"type":"WKTSelector","value":"POLYGON Z((-6.2168373724000645 22.17773678657583 0.0,0.2173452191648213 25.172597885131836 0.0,-6.2168373724000645 25.172597885131836 0.0,-6.2168373724000645 22.17773678657583 -3.2953948974609375,0.2173452191648213 22.17773678657583 -3.2953948974609375,0.2173452191648213 25.172597885131836 -3.2953948974609375,-6.2168373724000645 25.172597885131836 -3.2953948974609375))"},"rights":"https://creativecommons.org/licenses/by-sa/4.0/","dimensions":{"x":565,"y":594}},"@context":"http://www.w3.org/ns/anno.jsonld","id":"#fbab234d-0085-4edc-a453-7bdc3544b3cf","rights":"https://creativecommons.org/publicdomain/zero/1.0/","creator":{"id":"https://orcid.org/0000-0002-9499-5840","type":"Person","name":"Timo Homburg","nickname":"situx"},"generator":{"id":"https://github.com/recogito/annotorious-openseadragon","type":"Software","name":"Annotorious-OpenSeadragon 1.5.6","homepage":"https://github.com/recogito/annotorious-openseadragon"}},"#bf5ee786-5c10-480f-8486-27206df83655":{"type":"Annotation","body":[{"type":"TextualBody","purpose":"Transliteration","value":"um","source":"http://purl.org/cuneiform/Transliteration"},{"type":"TextualBody","value":"Character","purpose":"tagging","source":"http://purl.org/cuneiform/Character"}],"target":{"source":"https://heidicon.ub.uni-heidelberg.de/eas/partitions/1/0/577000/577625/394a3193b8abd18076a3c19198df8eebc462650b/application/x-ply/HS_1185_HeiCuBeDa_GigaMesh.ply","selector":{"type":"WKTSelector","value":"POLYGON Z((-10.390544784174557 0.4339518557975589 0.0,-4.521374861961972 4.122966411185987 0.0,-10.390544784174557 4.122966411185987 0.0,-10.390544784174557 0.4339518557975589 -3.2953948974609375,-4.521374861961972 0.4339518557975589 -3.2953948974609375,-4.521374861961972 4.122966411185987 -3.2953948974609375,-10.390544784174557 4.122966411185987 -3.2953948974609375))"},"rights":"https://creativecommons.org/licenses/by-sa/4.0/","dimensions":{"x":565,"y":594}},"@context":"http://www.w3.org/ns/anno.jsonld","id":"#bf5ee786-5c10-480f-8486-27206df83655","rights":"https://creativecommons.org/publicdomain/zero/1.0/","creator":{"id":"https://orcid.org/0000-0002-9499-5840","type":"Person","name":"Timo Homburg","nickname":"situx"},"generator":{"id":"https://github.com/recogito/annotorious-openseadragon","type":"Software","name":"Annotorious-OpenSeadragon 1.5.6","homepage":"https://github.com/recogito/annotorious-openseadragon"}},"#4511a217-5c11-4562-82ec-c27767d963a2":{"type":"Annotation","body":[{"type":"TextualBody","purpose":"Transliteration","value":"eridu","source":"http://purl.org/cuneiform/Transliteration"},{"type":"TextualBody","value":"Character","purpose":"tagging","source":"http://purl.org/cuneiform/Character"},{"type":"TextualBody","purpose":"Line","value":"5","source":"http://purl.org/cuneiform/Line"},{"type":"TextualBody","purpose":"Charindex","value":"3","source":"http://purl.org/cuneiform/CharacterIndex"}],"target":{"source":"https://heidicon.ub.uni-heidelberg.de/eas/partitions/1/0/577000/577625/394a3193b8abd18076a3c19198df8eebc462650b/application/x-ply/HS_1185_HeiCuBeDa_GigaMesh.ply","selector":{"type":"WKTSelector","value":"POLYGON Z((0.3476674501874797 22.308261368202437 0.0,6.390883348684394 24.43479497405415 0.0,0.3476674501874797 24.43479497405415 0.0,0.3476674501874797 22.308261368202437 -3.2953948974609375,6.390883348684394 22.308261368202437 -3.2953948974609375,6.390883348684394 24.43479497405415 -3.2953948974609375,0.3476674501874797 24.43479497405415 -3.2953948974609375))"},"rights":"https://creativecommons.org/licenses/by-sa/4.0/","dimensions":{"x":565,"y":594}},"@context":"http://www.w3.org/ns/anno.jsonld","id":"#4511a217-5c11-4562-82ec-c27767d963a2","rights":"https://creativecommons.org/publicdomain/zero/1.0/","creator":{"id":"https://orcid.org/0000-0002-9499-5840","type":"Person","name":"Timo Homburg","nickname":"situx"},"generator":{"id":"https://github.com/recogito/annotorious-openseadragon","type":"Software","name":"Annotorious-OpenSeadragon 1.5.6","homepage":"https://github.com/recogito/annotorious-openseadragon"}},"#3c155a13-a8d4-4952-b6b5-9fc56b4fb2c6":{"type":"Annotation","body":[{"type":"TextualBody","purpose":"Transliteration","value":"ki","source":"http://purl.org/cuneiform/Transliteration"},{"type":"TextualBody","value":"Character","purpose":"tagging","source":"http://purl.org/cuneiform/Character"},{"type":"TextualBody","purpose":"Line","value":"5","source":"http://purl.org/cuneiform/Line"},{"type":"TextualBody","purpose":"Charindex","value":"4","source":"http://purl.org/cuneiform/CharacterIndex"}],"target":{"source":"https://heidicon.ub.uni-heidelberg.de/eas/partitions/1/0/577000/577625/394a3193b8abd18076a3c19198df8eebc462650b/application/x-ply/HS_1185_HeiCuBeDa_GigaMesh.ply","selector":{"type":"WKTSelector","value":"POLYGON Z((6.6082285678492205 21.83066005815962 0.0,9.694785381418413 24.478020647190235 0.0,6.6082285678492205 24.478020647190235 0.0,6.6082285678492205 21.83066005815962 -3.2953948974609375,9.694785381418413 21.83066005815962 -3.2953948974609375,9.694785381418413 24.478020647190235 -3.2953948974609375,6.6082285678492205 24.478020647190235 -3.2953948974609375))"},"rights":"https://creativecommons.org/licenses/by-sa/4.0/","dimensions":{"x":565,"y":594}},"@context":"http://www.w3.org/ns/anno.jsonld","id":"#3c155a13-a8d4-4952-b6b5-9fc56b4fb2c6","rights":"https://creativecommons.org/publicdomain/zero/1.0/","creator":{"id":"https://orcid.org/0000-0002-9499-5840","type":"Person","name":"Timo Homburg","nickname":"situx"},"generator":{"id":"https://github.com/recogito/annotorious-openseadragon","type":"Software","name":"Annotorious-OpenSeadragon 1.5.6","homepage":"https://github.com/recogito/annotorious-openseadragon"}}}
var meshrefsampleannotations={"#9a51d1e2-c25e-403b-97fc-21f6294d9713": {
        "type": "Annotation",
        "body": [
            {
                "type": "TextualBody",
                "purpose": "Transliteration",
                "value": "szu",
                "source": "http://purl.org/cuneiform/Transliteration"
            },
            {
                "type": "TextualBody",
                "value": "Character",
                "purpose": "tagging",
                "source": "http://purl.org/cuneiform/Character"
            },
            {
                "type": "TextualBody",
                "purpose": "Charindex",
                "value": "1",
                "source": "http://purl.org/cuneiform/CharacterIndex"
            },
            {
                "type": "TextualBody",
                "purpose": "Line",
                "source": "http://purl.org/cuneiform/Line",
                "value": "1"
            },
            {
                "type": "TextualBody",
                "purpose": "Wordindex",
                "value": "1",
                "source": "http://purl.org/cuneiform/WordIndex"
            },
            {
                "type": "TextualBody",
                "purpose": "RelCharindex",
                "value": "0",
                "source": "http://purl.org/cuneiform/RelativeCharacterIndex"
            }
        ],
        "target": {
            "source": "https://heidicon.ub.uni-heidelberg.de/eas/partitions/1/0/575000/575702/e3e95552fd0da2aea583c919e60a3b6876f01950/application/x-ply/HS_1004_HeiCuBeDa_GigaMesh.ply",
            "selector": {
                "type": "MeshRefSelector",
                "value": "[v[n=10]]"
            },
            "rights": "https://creativecommons.org/licenses/by-sa/4.0/",
            "dimensions": {
                "x": 827,
                "y": 832
            }
        }}}
</script>
</head>
  <body>
    <h1>ThreeJS Annotation Test with glTF</h1>
	<canvas id="number" width="64" height="64" style="display:none"></canvas>
   <span id="annocontent"></span>
   <div style="display: flex;">
   <div id="threejs" class="threejscontainer" style="flex: 1;max-width:100%;max-height:90%"></div>
   <div id="threejsnav" style="flex: 1;"></div> 
   </div>
  </body>
</html>
<script>
//style="max-width:485px;max-height:500px"
//wktsampleannotations
//$(document).ready(function(){initThreeJS('threejs',parseWKTStringToJSON("POLYGON Z ((11.914378496415974 14.386346805085239 4.228275299072266, 7.128430444339905 14.260676340056541 4.228275299072266, 6.809366923512812 19.915864141095675 4.228275299072266, 11.488962055423293 19.915864141095675 4.228275299072266, 11.914378496415974 14.386346805085239 6.769923210144043, 7.128430444339905 14.260676340056541 6.769923210144043, 6.809366923512812 19.915864141095675 6.769923210144043, 11.488962055423293 19.915864141095675 6.769923210144043, 11.914378496415974 14.386346805085239 4.228275299072266))"),["HS1185.gltf"])})
$(document).ready(function(){initThreeJS('threejs',meshrefsampleannotations,["HS1185.gltf"])})</script> 

<script>
const canvas = document.getElementById('number');
const ctx = canvas.getContext('2d');
const x = 32;
const y = 32;
const radius = 30;
const startAngle = 0;
const endAngle = Math.PI * 2;

ctx.fillStyle = 'rgb(0, 0, 0)';
ctx.beginPath();
ctx.arc(x, y, radius, startAngle, endAngle);
ctx.fill();

ctx.strokeStyle = 'rgb(255, 255, 255)';
ctx.lineWidth = 3;
ctx.beginPath();
ctx.arc(x, y, radius, startAngle, endAngle);
ctx.stroke();

ctx.fillStyle = 'rgb(255, 255, 255)';
ctx.font = '32px sans-serif';
ctx.textAlign = 'center';
ctx.textBaseline = 'middle';
ctx.fillText('1', x, y);

function parseWebAnnotations(webannotations,annotations,mesh){
	for(anno in webannotations){
		console.log("Anno: "+anno)
		if("target" in webannotations[anno]){
			console.log(webannotations[anno])
			if("selector" in webannotations[anno]["target"] && webannotations[anno]["target"]["selector"]["type"]=="WKTSelector"){
				console.log(webannotations[anno]["target"]["selector"])
				if(webannotations[anno]["target"]["selector"]["value"].includes("POINT")){
					annotations=addPointMarker(parseWKTStringToJSON(webannotations[anno]["target"]["selector"]["value"])[0],annotations)
				}else{
					annotations=prepareAnnotationFromJSON(parseWKTStringToJSON(webannotations[anno]["target"]["selector"]["value"]),annotations)
				}			
			}else if("selector" in webannotations[anno]["target"] && webannotations[anno]["target"]["selector"]["type"]=="MeshRefSelector"){
				theindex=parseMeshRefToIndex(webannotations[anno]["target"]["selector"]["value"])
				if(theindex!=null){
					theindex=webannotations[anno]["target"]["selector"]["value"]
					lookeduppoint=lookUpPointFromIndex(mesh,theindex)
					if(lookeduppoint!=null){
						addPointMarker(lookeduppoint,annotations)
					}
				}
			}
		}
	}
	return annotations
}

function parseMeshRefToIndex(meshrefString){
	meshrefString=meshrefString.replaceAll("[","").replaceAll("]","")
	if("n=" in meshrefString){
		return meshrefString.replace("n=","")
	}
	return null
}

function lookUpPointFromIndex(mesh,theindex){
	indexlength=mesh["geometry"]["attributes"]["position"]["array"].length/3
	if(theindex<indexlength){
		return {"x":mesh["geometry"]["attributes"]["position"]["array"][theindex*3],"y":mesh["geometry"]["attributes"]["position"]["array"][(theindex*3)+1],"z":mesh["geometry"]["attributes"]["position"]["array"][(theindex*3)+2]}
	}
	return null
}

function parseWKTStringToJSON(wktstring){
    wktstring=wktstring.substring(wktstring.lastIndexOf('(')+1,wktstring.lastIndexOf(')')-1)
    resjson=[]
    for(coordset of wktstring.split(",")){
        curobject={}
        coords=coordset.trim().split(" ")
        console.log(coordset)
        console.log(coords)
        if(coords.length==3){
            resjson.push({"x":parseFloat(coords[0]),"y":parseFloat(coords[1]),"z":parseFloat(coords[2])})
        }else{
            resjson.push({"x":parseFloat(coords[0]),"y":parseFloat(coords[1])})
        }
    }
    console.log(resjson)
    return resjson
}

let camera, scene, renderer,controls;


function addPointMarker(position,annotations){
	const numberTexture = new THREE.CanvasTexture(
		 document.querySelector('#number')
	);

	const spriteMaterial = new THREE.SpriteMaterial({
		map: numberTexture,
		alphaTest: 0.5,
		transparent: true,
		depthTest: false,
		depthWrite: false
	});

	sprite = new THREE.Sprite(spriteMaterial);
	sprite.position.set(position["x"], position["y"], position["z"]);
	sprite.scale.set(1, 1, 1);
	annotations.add(sprite)
	return annotations
}

function prepareAnnotationFromJSON(verts,annotations){
	var svgShape = new THREE.Shape();
    first=true
    for(vert of verts){
        if(first){
            svgShape.moveTo(vert["x"], vert["y"]);
           first=false
        }else{
            svgShape.lineTo(vert["x"], vert["y"]);
        }
        vertarray.push(vert["x"])
        vertarray.push(vert["y"])
        vertarray.push(vert["z"])
        if(vert["z"]>maxz){
            maxz=vert["z"]
        }
        if(vert["z"]<minz){
            minz=vert["z"]
        }
        if(vert["y"]>maxy){
            maxy=vert["y"]
        }
        if(vert["y"]<miny){
            miny=vert["y"]
        }
        if(vert["x"]>maxx){
            maxy=vert["x"]
        }
        if(vert["x"]<minx){
            miny=vert["x"]
        }
    }
	var extrudedGeometry = new THREE.ExtrudeGeometry(svgShape, {depth: maxz-minz, bevelEnabled: false});
    extrudedGeometry.computeBoundingBox()
    const material = new THREE.MeshBasicMaterial( { color: 0xFFFFFF, wireframe:true } );
    const mesh = new THREE.Mesh( extrudedGeometry, material );
	annotations.add(mesh)
	return annotations
}

function initThreeJS(domelement,webannotations,meshurls) {
    scene = new THREE.Scene();
    minz=Number.MAX_VALUE
    maxz=Number.MIN_VALUE
    miny=Number.MAX_VALUE
    maxy=Number.MIN_VALUE
    minx=Number.MAX_VALUE
    maxx=Number.MIN_VALUE
	vertarray=[]
	annotations=new THREE.Group();
	objects=new THREE.Group();
    console.log(webannotations)
    first=true
	//annotations=prepareAnnotationFromJSON(verts,annotations)  
	const gui = new dat.GUI({autoPlace: true})
	gui.domElement.id="gui"
	const geometryFolder = gui.addFolder("Mesh");
	geometryFolder.open();
	const lightingFolder = geometryFolder.addFolder("Lighting");
	const geometryF = geometryFolder.addFolder("Geometry");
	geometryF.open();
	annotations=parseWebAnnotations(webannotations,annotations,null)
	box=null
	if(meshurls.length>0){
        var loader = new THREE.GLTFLoader();
        loader.load(meshurls[0], function ( gltf )
		{
			box = gltf.scene;  // sword 3D object is loaded
			//sword.scale.set(200, 200, 200);
			box.position.x = 0;
			box.position.y = 0;
			console.log(box)
			//console.log(gltf)
			if("annotations" in box){
				console.log(box["annotations"])
			}

			geometryF.close();
			objects.add(box)
			scene.add(objects);
			const rotationFolder = geometryF.addFolder("Rotation");
			rotationFolder.add(objects.rotation, 'x', 0, Math.PI).name("X").onChange(
			function(){
				yourVar = this.getValue();
				scene.traverse(function(obj){
					if(obj.type === 'Mesh'){
						obj.rotation.x = yourVar;
					}});
			});
			rotationFolder.add(objects.rotation, 'y', 0, Math.PI).name("Y").onChange(
			function(){
				yourVar = this.getValue();
				scene.traverse(function(obj){
					if(obj.type === 'Mesh'){
						obj.rotation.y = yourVar;
					}});
			});
			rotationFolder.add(objects.rotation, 'z', 0, Math.PI).name("Z").onChange(
			function(){
				yourVar = this.getValue();
				scene.traverse(function(obj){
					if(obj.type === 'Mesh'){
						obj.rotation.z = yourVar;
					}});
			});

			const scaleFolder = geometryF.addFolder("Scale");
			scaleFolder.add(objects.scale, 'x', 0, 2).name("X").onChange(
			function(){
				yourVar = this.getValue();
				scene.traverse(function(obj){
					if(obj.type === 'Mesh'){
						obj.scale.x = yourVar;
					}});
			});
			scaleFolder.add(objects.scale, 'y', 0, 2).name("Y").onChange(
			function(){
				yourVar = this.getValue();
				scene.traverse(function(obj){
					if(obj.type === 'Mesh'){
						obj.scale.y = yourVar;
					}});
			});
			scaleFolder.add(objects.scale, 'z', 0, 2).name("Z").onChange(
			function(){
				yourVar = this.getValue();
				scene.traverse(function(obj){
					if(obj.type === 'Mesh'){
						obj.scale.z = yourVar;
					}});
			});
		});
    }
	var raycaster = new THREE.Raycaster();
    camera = new THREE.PerspectiveCamera(90,window.innerWidth / window.innerHeight, 0.1, 150 );
    scene.add(new THREE.AmbientLight(0x222222));
    var light = new THREE.DirectionalLight(0xffffff, 1);
    light.position.set(20, 20, 0);
    scene.add(light);
    lightingFolder.add(light.position, "x").min(-5).max(5).step(0.01).name("X Position")
	lightingFolder.add(light.position, "y").min(-5).max(5).step(0.01).name("Y Position")
	lightingFolder.add(light.position, "z").min(-5).max(5).step(0.01).name("Z Position")
	var axesHelper = new THREE.AxesHelper( Math.max(maxx, maxy, maxz)*4 );
    scene.add( axesHelper );
    console.log("Depth: "+(maxz-minz))
	scene.add(annotations)
	annotations=addPointMarker({"x":0.5,"y":0.5,"z":0.5},annotations)
    renderer = new THREE.WebGLRenderer( { antialias: false } );
	renderer.setPixelRatio( window.devicePixelRatio );
    renderer.setSize(0.8*window.innerWidth, 0.8*window.innerHeight);
    document.getElementById(domelement).appendChild( renderer.domElement );
	document.getElementById("threejsnav").appendChild( gui.domElement );
	document.getElementById(domelement).addEventListener('click', function(event){
	  var bounds = document.getElementById(domelement).getBoundingClientRect()
	  console.log(bounds)
	  mouse={}
	  mouse.x = ( (event.clientX - bounds.left) / document.getElementById(domelement).clientWidth ) * 2 - 1;
	  mouse.y = - ( (event.clientY - bounds.top) / document.getElementById(domelement).clientHeight ) * 2 + 1;
	  raycaster.setFromCamera( mouse, camera );
	  var intersects = raycaster.intersectObjects(annotations, true);
	  if (intersects.length > 0) {
	     //console.log(mesh)
		 console.log(scene.children)
		 document.getElementById("annocontent").innerHTML="Clicked on point in annotation: "+mouse.x+" "+mouse.y
		 console.log("INTERSECTIONNNNNN")
	  }
	}, false)
	centervec=new THREE.Vector3()
    //annotations.children[0].boundingBox.getCenter(centervec)
    console.log(centervec)
	controls = new THREE.OrbitControls( camera, renderer.domElement );
    controls.target.set( 0,0,0 );
    camera.position.x= 0
    camera.position.y= 40
    camera.position.z = 40;
    controls.maxDistance= Math.max(maxx, maxy, maxz)*5
    controls.update();
	const updateCamera = () => {
		camera.updateProjectionMatrix();
	}
	const cameraFolder = geometryFolder.addFolder("Camera");
	cameraFolder.add (camera, 'fov', 1, 180).name('Zoom').onChange(updateCamera);
	gui.add(objects, 'visible').name('Meshes')
    gui.add(annotations, 'visible').name('Annotations')
	animate()
}

function resizeCanvasToDisplaySize() {
  const canvas = renderer.domElement;
  // look up the size the canvas is being displayed
  const width = canvas.clientWidth;
  const height = canvas.clientHeight;

  // adjust displayBuffer size to match
  if (canvas.width !== width || canvas.height !== height) {
    // you must pass false here or three.js sadly fights the browser
    renderer.setSize(width, height, false);
    camera.aspect = width / height;
    camera.updateProjectionMatrix();

    // update any render target sizes here
  }
}

function animate() {
	resizeCanvasToDisplaySize();
    requestAnimationFrame( animate );
    controls.update();
    renderer.render( scene, camera );
}</script>
